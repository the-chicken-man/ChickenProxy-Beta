const tabBar = document.getElementById('tabBar') as HTMLElement | null;
const iframe = document.getElementById('frame') as HTMLIFrameElement | null;

type Tab = {
  id: string;
  url: string;
  element: HTMLButtonElement;
};

let tabs: Tab[] = [];
let currentTab: Tab | null = null;

function createTab(url = 'https://example.com') {
  if (!tabBar) return;

  const tabId = Date.now().toString(); // Fix: use string, not number
  const tab = document.createElement('button');
  tab.className = "text-[#a5adce] hover:text-white px-3 py-1 rounded bg-[#1e1e2e] text-sm transition";
  tab.textContent = url.replace(/^https?:\/\//, '').split('/')[0].slice(0, 15) + '...';
  tab.dataset.id = tabId;

  tab.onclick = () => switchTab(tabId);
  const newTabBtn = document.getElementById('newTab');
  if (newTabBtn) tabBar.insertBefore(tab, newTabBtn);

  tabs.push({ id: tabId, url, element: tab });
  switchTab(tabId);
}

function switchTab(id: string) {
  const tab = tabs.find(t => t.id === id);
  if (!tab || !iframe) return;

  currentTab = tab;
  iframe.src = tab.url;

  tabs.forEach(t => t.element.classList.remove('bg-[#2e2e3e]'));
  tab.element.classList.add('bg-[#2e2e3e]');
}

const newTabBtn = document.getElementById('newTab');
if (newTabBtn) {
  newTabBtn.onclick = () => {
    createTab('https://duckduckgo.com');
  };
}

// Create initial tab
createTab('https://example.com');
